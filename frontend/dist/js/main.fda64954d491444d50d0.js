(()=>{"use strict";var e,s,a,t={912:(e,s,a)=>{var t=a(540),i=a(338),n=a(976),r=a(767);const l="scratchlab_access_token",c="scratchlab_refresh_token",d="scratchlab_user",o="/login",h="/experiments",m="/experiments/new",u="/admin";const p=new class{constructor(e="/api/v1"){this.baseURL=e}getAccessToken(){return sessionStorage.getItem(l)}getHeaders(e={}){const s={"Content-Type":"application/json",...e},a=this.getAccessToken();return a&&(s.Authorization=`Bearer ${a}`),s}async handleResponse(e){const s=await e.json();if(!e.ok){const a=new Error(s.message||"Произошла ошибка");throw a.status=e.status,a.data=s,a}return s}async get(e,s={}){const a=new URL(`${this.baseURL}${e}`,window.location.origin);Object.entries(s).forEach(([e,s])=>{null!=s&&a.searchParams.append(e,s)});const t=await fetch(a.toString(),{method:"GET",headers:this.getHeaders()});return this.handleResponse(t)}async post(e,s={}){const a=await fetch(`${this.baseURL}${e}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(s)});return this.handleResponse(a)}async postFormData(e,s){const a={},t=this.getAccessToken();t&&(a.Authorization=`Bearer ${t}`);const i=await fetch(`${this.baseURL}${e}`,{method:"POST",headers:a,body:s});return this.handleResponse(i)}async patch(e,s={}){const a=await fetch(`${this.baseURL}${e}`,{method:"PATCH",headers:this.getHeaders(),body:JSON.stringify(s)});return this.handleResponse(a)}async delete(e){const s=await fetch(`${this.baseURL}${e}`,{method:"DELETE",headers:this.getHeaders()});return 204===s.status?{success:!0}:this.handleResponse(s)}};const x=new class{async register(e){return(await p.post("/auth/register",e)).data}async login(e){const s=await p.post("/auth/login",e);return s.success&&s.data&&this.saveTokens(s.data),s.data}logout(){sessionStorage.removeItem(l),sessionStorage.removeItem(c),sessionStorage.removeItem(d)}async getCurrentUser(){return(await p.get("/auth/me")).data}saveTokens(e){e.access_token&&sessionStorage.setItem(l,e.access_token),e.refresh_token&&sessionStorage.setItem(c,e.refresh_token),e.user&&sessionStorage.setItem(d,JSON.stringify(e.user))}getStoredUser(){const e=sessionStorage.getItem(d);return e?JSON.parse(e):null}isAuthenticated(){return!!sessionStorage.getItem(l)}isAdmin(){const e=this.getStoredUser();return!(!e||!e.roles)&&e.roles.some(e=>"admin"===e.name)}};var g=a(848);const j=(0,t.createContext)(null);function f({children:e}){const[s,a]=(0,t.useState)(null),[i,n]=(0,t.useState)(!0),[r,l]=(0,t.useState)(null);(0,t.useEffect)(()=>{(()=>{try{if(x.isAuthenticated()){const e=x.getStoredUser();a(e)}}catch(e){console.error("Auth init error:",e)}finally{n(!1)}})()},[]);const c=(0,t.useCallback)(async e=>{l(null),n(!0);try{const s=await x.login(e);return a(s.user),s}catch(e){throw l(e.message||"Ошибка авторизации"),e}finally{n(!1)}},[]),d=(0,t.useCallback)(async e=>{l(null),n(!0);try{return await x.register(e)}catch(e){throw l(e.message||"Ошибка регистрации"),e}finally{n(!1)}},[]),o=(0,t.useCallback)(()=>{x.logout(),a(null),l(null)},[]),h=(0,t.useCallback)(()=>{l(null)},[]),m=(0,t.useMemo)(()=>!(!s||!s.roles)&&s.roles.some(e=>"admin"===e.name),[s]),u=(0,t.useMemo)(()=>({user:s,isLoading:i,error:r,isAuthenticated:!!s,isAdmin:m,login:c,register:d,logout:o,clearError:h}),[s,i,r,m,c,d,o,h]);return(0,g.jsx)(j.Provider,{value:u,children:e})}function v(){const e=(0,t.useContext)(j);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e}const y=(0,t.createContext)(null);let b=0;function N({children:e}){const[s,a]=(0,t.useState)([]),i=(0,t.useCallback)(e=>{a(s=>s.filter(s=>s.id!==e))},[]),n=(0,t.useCallback)(e=>{const s=++b,t={id:s,type:"info",duration:5e3,...e};return a(e=>[...e,t]),t.duration>0&&setTimeout(()=>{i(s)},t.duration),s},[i]),r=(0,t.useCallback)(()=>{a([])},[]),l=(0,t.useCallback)((e,s={})=>n({type:"success",message:e,...s}),[n]),c=(0,t.useCallback)((e,s={})=>n({type:"error",message:e,duration:8e3,...s}),[n]),d=(0,t.useCallback)((e,s={})=>n({type:"warning",message:e,...s}),[n]),o=(0,t.useCallback)((e,s={})=>n({type:"info",message:e,...s}),[n]),h=(0,t.useMemo)(()=>({notifications:s,addNotification:n,removeNotification:i,clearNotifications:r,success:l,error:c,warning:d,info:o}),[s,n,i,r,l,c,d,o]);return(0,g.jsx)(y.Provider,{value:h,children:e})}function w(){const e=(0,t.useContext)(y);if(!e)throw new Error("useNotification must be used within a NotificationProvider");return e}const k="c0nm51Ln",C="s0HZM2Rc";function _(){const{user:e,isAdmin:s,logout:a}=v(),t=(0,r.Zp)(),i=(0,r.zy)();return(0,g.jsx)("header",{className:"kqjyD_5n",children:(0,g.jsxs)("div",{className:"e9HKru1K",children:[(0,g.jsxs)(n.N_,{to:h,className:"cxpWkSVN",children:[(0,g.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,g.jsx)("rect",{x:"2",y:"2",width:"28",height:"28",rx:"6",stroke:"currentColor",strokeWidth:"2"}),(0,g.jsx)("path",{d:"M8 16H24M16 8V24M10 10L22 22M22 10L10 22",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.5"}),(0,g.jsx)("circle",{cx:"16",cy:"16",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),(0,g.jsx)("span",{className:"f14walCF",children:"ScratchLab"})]}),(0,g.jsxs)("nav",{className:"kQISQMfQ",children:[(0,g.jsx)(n.N_,{to:h,className:`${k} ${l=h,i.pathname===l?C:""}`,children:"Эксперименты"}),s&&(0,g.jsx)(n.N_,{to:u,className:`${k} ${i.pathname.startsWith("/admin")?C:""}`,children:"Админ-панель"})]}),(0,g.jsxs)("div",{className:"eG8BW2JX",children:[(0,g.jsxs)("div",{className:"bmjy3dNW",children:[(0,g.jsx)("div",{className:"WIXYxJ22",children:e?.username?.[0]?.toUpperCase()||"U"}),(0,g.jsxs)("div",{className:"nd1Nimji",children:[(0,g.jsx)("span",{className:"lkO3tDTT",children:e?.username}),(0,g.jsx)("span",{className:"si9aE37m",children:s?"Администратор":"Пользователь"})]})]}),(0,g.jsx)("button",{type:"button",className:"_saWJ9Tm",onClick:()=>{a(),t(o)},title:"Выйти",children:(0,g.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,g.jsx)("path",{fillRule:"evenodd",d:"M3 4.25A2.25 2.25 0 015.25 2h5.5A2.25 2.25 0 0113 4.25v2a.75.75 0 01-1.5 0v-2a.75.75 0 00-.75-.75h-5.5a.75.75 0 00-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 00.75-.75v-2a.75.75 0 011.5 0v2A2.25 2.25 0 0110.75 18h-5.5A2.25 2.25 0 013 15.75V4.25z",clipRule:"evenodd"}),(0,g.jsx)("path",{fillRule:"evenodd",d:"M6 10a.75.75 0 01.75-.75h9.546l-1.048-1.048a.75.75 0 111.06-1.06l2.5 2.5a.75.75 0 010 1.06l-2.5 2.5a.75.75 0 11-1.06-1.06l1.048-1.048H6.75A.75.75 0 016 10z",clipRule:"evenodd"})]})})]})]})});var l}var S=a(556),L=a.n(S);function R({children:e}){return(0,g.jsxs)("div",{className:"qOGIGrDn",children:[(0,g.jsx)(_,{}),(0,g.jsx)("main",{className:"eHAjLngI",children:e})]})}R.propTypes={children:L().node.isRequired};const I={button:"rHBNQrpv",sm:"P30ada3C",md:"WRw6MuDl",lg:"VE14Rbow",primary:"m1vUFSML",secondary:"Qgni6nBg",danger:"R57XAOVM",ghost:"wA6Gw689",outline:"X87k8qtu",fullWidth:"wRi4_LzV",loading:"X0yevVji",content:"gb3GBRG2",spinner:"q4gYReHO",spin:"ZWWDvOhM",icon:"SKlDcyWC"};function M({children:e,type:s="button",variant:a="primary",size:t="md",disabled:i=!1,loading:n=!1,fullWidth:r=!1,icon:l,iconPosition:c="left",className:d="",onClick:o,...h}){const m=[I.button,I[a],I[t],r&&I.fullWidth,n&&I.loading,d].filter(Boolean).join(" ");return(0,g.jsxs)("button",{type:s,className:m,disabled:i||n,onClick:o,...h,children:[n&&(0,g.jsx)("span",{className:I.spinner,"aria-hidden":"true"}),l&&"left"===c&&!n&&(0,g.jsx)("span",{className:I.icon,children:l}),(0,g.jsx)("span",{className:I.content,children:e}),l&&"right"===c&&!n&&(0,g.jsx)("span",{className:I.icon,children:l})]})}M.propTypes={children:L().node.isRequired,type:L().oneOf(["button","submit","reset"]),variant:L().oneOf(["primary","secondary","danger","ghost","outline"]),size:L().oneOf(["sm","md","lg"]),disabled:L().bool,loading:L().bool,fullWidth:L().bool,icon:L().node,iconPosition:L().oneOf(["left","right"]),className:L().string,onClick:L().func};const B={wrapper:"MTSXUi00",fullWidth:"vP11nGVZ",label:"GTkLMt3r",required:"CC6LWroF",inputWrapper:"DT8HdkD2",icon:"zDvu0Fb5",input:"BBhf_Yma",hasError:"qyCfbX80",error:"ansU7bHN",hint:"bDIuPjXW"},O=(0,t.forwardRef)(function({type:e="text",label:s,error:a,hint:t,icon:i,disabled:n=!1,required:r=!1,fullWidth:l=!0,className:c="",id:d,...o},h){const m=d||`input-${Math.random().toString(36).substr(2,9)}`,u=[B.wrapper,l&&B.fullWidth,a&&B.hasError,n&&B.disabled,c].filter(Boolean).join(" ");return(0,g.jsxs)("div",{className:u,children:[s&&(0,g.jsxs)("label",{htmlFor:m,className:B.label,children:[s,r&&(0,g.jsx)("span",{className:B.required,children:"*"})]}),(0,g.jsxs)("div",{className:B.inputWrapper,children:[i&&(0,g.jsx)("span",{className:B.icon,children:i}),(0,g.jsx)("input",{ref:h,type:e,id:m,className:B.input,disabled:n,"aria-invalid":!!a,"aria-describedby":a?`${m}-error`:t?`${m}-hint`:void 0,...o})]}),a&&(0,g.jsx)("span",{id:`${m}-error`,className:B.error,role:"alert",children:a}),t&&!a&&(0,g.jsx)("span",{id:`${m}-hint`,className:B.hint,children:t})]})});O.propTypes={type:L().oneOf(["text","password","email","number","tel","url","search"]),label:L().string,error:L().string,hint:L().string,icon:L().node,disabled:L().bool,required:L().bool,fullWidth:L().bool,className:L().string,id:L().string};const $={wrapper:"BvJmXB_8",fullWidth:"oJxG0ZL6",label:"u1bXwBQY",required:"X2WJYcUf",selectWrapper:"bcIlrxHh",select:"_1cKiL7U",arrow:"UmWheNrq",hasError:"gIYdMq5m",error:"JVog2usZ",hint:"YgahU8w5"},q=(0,t.forwardRef)(function({label:e,options:s=[],error:a,hint:t,disabled:i=!1,required:n=!1,fullWidth:r=!0,placeholder:l="Выберите...",className:c="",id:d,...o},h){const m=d||`select-${Math.random().toString(36).substr(2,9)}`,u=[$.wrapper,r&&$.fullWidth,a&&$.hasError,i&&$.disabled,c].filter(Boolean).join(" ");return(0,g.jsxs)("div",{className:u,children:[e&&(0,g.jsxs)("label",{htmlFor:m,className:$.label,children:[e,n&&(0,g.jsx)("span",{className:$.required,children:"*"})]}),(0,g.jsxs)("div",{className:$.selectWrapper,children:[(0,g.jsxs)("select",{ref:h,id:m,className:$.select,disabled:i,"aria-invalid":!!a,...o,children:[(0,g.jsx)("option",{value:"",disabled:!0,children:l}),s.map(e=>(0,g.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,g.jsx)("span",{className:$.arrow,children:(0,g.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"currentColor",children:(0,g.jsx)("path",{d:"M2.5 4.5L6 8L9.5 4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})})]}),a&&(0,g.jsx)("span",{className:$.error,role:"alert",children:a}),t&&!a&&(0,g.jsx)("span",{className:$.hint,children:t})]})});q.propTypes={label:L().string,options:L().arrayOf(L().shape({value:L().oneOfType([L().string,L().number]).isRequired,label:L().string.isRequired})),error:L().string,hint:L().string,disabled:L().bool,required:L().bool,fullWidth:L().bool,placeholder:L().string,className:L().string,id:L().string};const A=(0,t.forwardRef)(function({label:e,disabled:s=!1,className:a="",id:t,...i},n){const r=t||`checkbox-${Math.random().toString(36).substr(2,9)}`;return(0,g.jsxs)("label",{htmlFor:r,className:`V4_K1WDh ${s?"T6VeP3SO":""} ${a}`,children:[(0,g.jsx)("input",{ref:n,type:"checkbox",id:r,className:"Imw15y3I",disabled:s,...i}),(0,g.jsx)("span",{className:"FuCSX_mG",children:(0,g.jsx)("svg",{viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)("path",{d:"M2.5 6L5 8.5L9.5 3.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e&&(0,g.jsx)("span",{className:"CLKasJ_1",children:e})]})});A.propTypes={label:L().string,disabled:L().bool,className:L().string,id:L().string};const z={card:"tgEYvi79",default:"Op5qxSdv",elevated:"L6GD8aAr",outlined:"JA1Kr3bj",glass:"c386XG4C","padding-none":"grjoGdXS","padding-sm":"JGOtJ9TC","padding-md":"oCSphfXO","padding-lg":"sxFyNX9d",hoverable:"mPWPI7J5",clickable:"c4QYTfe1",accent:"Hiu9_3jF"};function T({children:e,variant:s="default",padding:a="md",hoverable:t=!1,className:i="",onClick:n,...r}){const l=[z.card,z[s],z[`padding-${a}`],t&&z.hoverable,n&&z.clickable,i].filter(Boolean).join(" "),c=n?"button":"div";return(0,g.jsx)(c,{className:l,onClick:n,type:n?"button":void 0,...r,children:e})}T.propTypes={children:L().node.isRequired,variant:L().oneOf(["default","elevated","outlined"]),padding:L().oneOf(["none","sm","md","lg"]),hoverable:L().bool,className:L().string,onClick:L().func};const E={spinner:"Ge9N7pY9",spin:"VD8eUzMm",track:"mXR4ykzG",progress:"c3eEhioy",sm:"b7bwJxUn",md:"ccL6BFcI",lg:"IwufYt3e",xl:"Oq1wf_EQ"};function W({size:e="md",className:s=""}){const a=[E.spinner,E[e],s].filter(Boolean).join(" ");return(0,g.jsxs)("div",{className:a,role:"status","aria-label":"Загрузка",children:[(0,g.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,g.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",className:E.track}),(0,g.jsx)("path",{d:"M12 2C6.47715 2 2 6.47715 2 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",className:E.progress})]}),(0,g.jsx)("span",{className:"sr-only",children:"Загрузка..."})]})}W.propTypes={size:L().oneOf(["sm","md","lg","xl"]),className:L().string};var F=a(961);const U={overlay:"Jg7aZgXZ",fadeIn:"KgaBIcTO",modal:"mmsTqGO1",slideUp:"aVeOzPaE",sm:"KqyCiI1D",md:"cjB_sELN",lg:"ZlO6oqRU",xl:"WtgTDZC_",full:"xI8QWINa",header:"_yaSCzef",title:"cqaGyO7E",closeButton:"tsLhGi5E",content:"rhaYU_oV"};function P({isOpen:e,onClose:s,title:a,children:i,size:n="md",closeOnOverlay:r=!0,closeOnEsc:l=!0,showCloseButton:c=!0,className:d=""}){const o=(0,t.useCallback)(e=>{"Escape"===e.key&&l&&s()},[l,s]);if((0,t.useEffect)(()=>(e&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}),[e,o]),!e)return null;const h=[U.modal,U[n],d].filter(Boolean).join(" ");return(0,F.createPortal)((0,g.jsx)("div",{className:U.overlay,onClick:e=>{e.target===e.currentTarget&&r&&s()},children:(0,g.jsxs)("div",{className:h,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,g.jsxs)("div",{className:U.header,children:[a&&(0,g.jsx)("h2",{id:"modal-title",className:U.title,children:a}),c&&(0,g.jsx)("button",{type:"button",className:U.closeButton,onClick:s,"aria-label":"Закрыть",children:(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,g.jsx)("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})]}),(0,g.jsx)("div",{className:U.content,children:i})]})}),document.body)}P.propTypes={isOpen:L().bool.isRequired,onClose:L().func.isRequired,title:L().string,children:L().node.isRequired,size:L().oneOf(["sm","md","lg","xl","full"]),closeOnOverlay:L().bool,closeOnEsc:L().bool,showCloseButton:L().bool,className:L().string};const H={container:"lc8IlhYZ",toast:"Ez6Dh6gO",slideIn:"tEXC27tu",icon:"UQl2VKsu",message:"GWJ4vfqg",closeButton:"IZG6T1Rs",success:"BgwZsnTX",error:"SFwWCH16",warning:"F4zXpftf",info:"OnfYpAYd"},V={success:(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,g.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})}),error:(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,g.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z",clipRule:"evenodd"})}),warning:(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,g.jsx)("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),info:(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,g.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})})};function X(){const{notifications:e,removeNotification:s}=w();return 0===e.length?null:(0,g.jsx)("div",{className:H.container,children:e.map(e=>(0,g.jsxs)("div",{className:`${H.toast} ${H[e.type]}`,role:"alert",children:[(0,g.jsx)("span",{className:H.icon,children:V[e.type]}),(0,g.jsx)("span",{className:H.message,children:e.message}),(0,g.jsx)("button",{type:"button",className:H.closeButton,onClick:()=>s(e.id),"aria-label":"Закрыть",children:(0,g.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,g.jsx)("path",{d:"M5.28 4.22a.75.75 0 00-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 101.06 1.06L8 9.06l2.72 2.72a.75.75 0 101.06-1.06L9.06 8l2.72-2.72a.75.75 0 00-1.06-1.06L8 6.94 5.28 4.22z"})})})]},e.id))})}function G({icon:e,title:s,description:a,action:t,onAction:i,className:n=""}){return(0,g.jsxs)("div",{className:`znjqdVf3 ${n}`,children:[e&&(0,g.jsx)("div",{className:"YYPMNFpJ",children:e}),(0,g.jsx)("h3",{className:"ecTZfXh1",children:s}),a&&(0,g.jsx)("p",{className:"HaQIHdkK",children:a}),t&&i&&(0,g.jsx)(M,{variant:"primary",onClick:i,children:t})]})}G.propTypes={icon:L().node,title:L().string.isRequired,description:L().string,action:L().string,onAction:L().func,className:L().string};function Z({children:e,requireAdmin:s=!1}){const{isAuthenticated:a,isAdmin:t,isLoading:i}=v(),n=(0,r.zy)();return i?(0,g.jsx)("div",{className:"Nvxu8j4E",children:(0,g.jsx)(W,{size:"xl"})}):a?s&&!t?(0,g.jsx)(r.C5,{to:h,replace:!0}):e:(0,g.jsx)(r.C5,{to:o,state:{from:n},replace:!0})}Z.propTypes={children:L().node.isRequired,requireAdmin:L().bool};const D=e=>{const s=[];return e?(e.size>10485760&&s.push("Размер файла не должен превышать 10 МБ"),["image/jpeg","image/png","image/webp"].includes(e.type)||s.push("Допустимые форматы: JPEG, PNG, WebP"),{isValid:0===s.length,errors:s}):(s.push("Файл не выбран"),{isValid:!1,errors:s})},J="OpxLRXiO";const Y=function(){const[e,s]=(0,t.useState)(!1),[a,i]=(0,t.useState)({username:"",email:"",password:"",confirmPassword:""}),[n,l]=(0,t.useState)({}),[c,d]=(0,t.useState)(!1),{login:o,register:m}=v(),{success:u,error:p}=w(),x=(0,r.Zp)(),j=(0,r.zy)(),f=j.state?.from?.pathname||h,y=e=>{const{name:s,value:a}=e.target;i(e=>({...e,[s]:a})),n[s]&&l(e=>({...e,[s]:""}))};return(0,g.jsxs)("div",{className:"UGOtfHsO",children:[(0,g.jsxs)("div",{className:"Qa5f_ALY",children:[(0,g.jsx)("div",{className:"t4g98Mem"}),(0,g.jsx)("div",{className:J}),(0,g.jsx)("div",{className:J}),(0,g.jsx)("div",{className:"S0LN6xzR"})]}),(0,g.jsx)("div",{className:"lT23YwG1",children:(0,g.jsxs)("div",{className:"o8OxHCLT",children:[(0,g.jsxs)("div",{className:"VpMyYeYz",children:[(0,g.jsx)("div",{className:"ToJm4OiW",children:(0,g.jsxs)("svg",{className:"dWrolS91",width:"36",height:"36",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,g.jsx)("path",{d:"M16 2L4 8V24L16 30L28 24V8L16 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"}),(0,g.jsx)("circle",{cx:"16",cy:"16",r:"5",stroke:"currentColor",strokeWidth:"2"}),(0,g.jsx)("path",{d:"M16 6V11M16 21V26M6 11L10.5 13.5M21.5 18.5L26 21M6 21L10.5 18.5M21.5 13.5L26 11",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.5"})]})}),(0,g.jsx)("span",{className:"hQuPHKcR",children:"ScratchLab"}),(0,g.jsx)("h1",{className:"ke4Nvl7U",children:e?"Регистрация":"Вход в систему"}),(0,g.jsx)("p",{className:"__gTmoy2",children:e?"Создайте аккаунт для работы с системой":"Система анализа устойчивости к царапинам"})]}),(0,g.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const s={},t=(e=>{const s=[];return e.length<3&&s.push("Минимум 3 символа"),e.length>50&&s.push("Максимум 50 символов"),/^[a-zA-Z0-9_]+$/.test(e)||s.push("Только буквы, цифры и подчеркивания"),{isValid:0===s.length,errors:s}})(a.username);var i;if(t.isValid||(s.username=t.errors[0]),e&&(a.email?(i=a.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)||(s.email="Некорректный формат email")):s.email="Введите email"),a.password){if(e){const e=(e=>{const s=[];return e.length<8&&s.push("Минимум 8 символов"),/[A-Z]/.test(e)||s.push("Минимум одна заглавная буква"),/[a-z]/.test(e)||s.push("Минимум одна строчная буква"),/[0-9]/.test(e)||s.push("Минимум одна цифра"),{isValid:0===s.length,errors:s}})(a.password);e.isValid||(s.password=e.errors[0])}}else s.password="Введите пароль";return e&&a.password!==a.confirmPassword&&(s.confirmPassword="Пароли не совпадают"),l(s),0===Object.keys(s).length})()){d(!0);try{e?(await m({username:a.username,email:a.email,password:a.password}),u("Регистрация успешна! Войдите в систему."),s(!1),i(e=>({...e,email:"",confirmPassword:""}))):(await o({username:a.username,password:a.password}),u("Вход выполнен успешно"),x(f,{replace:!0}))}catch(e){p(e.message||"Произошла ошибка")}finally{d(!1)}}},className:"ngmBA2gi",children:[(0,g.jsx)(O,{name:"username",label:"Имя пользователя",placeholder:"Введите имя пользователя",value:a.username,onChange:y,error:n.username,required:!0,autoComplete:"username"}),e&&(0,g.jsx)(O,{name:"email",type:"email",label:"Email",placeholder:"example@mail.com",value:a.email,onChange:y,error:n.email,required:!0,autoComplete:"email"}),(0,g.jsx)(O,{name:"password",type:"password",label:"Пароль",placeholder:"Введите пароль",value:a.password,onChange:y,error:n.password,required:!0,autoComplete:e?"new-password":"current-password"}),e&&(0,g.jsx)(O,{name:"confirmPassword",type:"password",label:"Подтвердите пароль",placeholder:"Повторите пароль",value:a.confirmPassword,onChange:y,error:n.confirmPassword,required:!0,autoComplete:"new-password"}),(0,g.jsx)(M,{type:"submit",variant:"primary",fullWidth:!0,loading:c,children:e?"Создать аккаунт":"Войти"})]}),(0,g.jsxs)("div",{className:"exIO_5u0",children:[(0,g.jsx)("span",{className:"uu5OXU2z",children:e?"Уже есть аккаунт?":"Нет аккаунта?"}),(0,g.jsx)("button",{type:"button",className:"RFx0ruyn",onClick:()=>{s(!e),l({})},children:e?"Войти":"Создать"})]})]})})]})};const Q=new class{async getAll(e={}){const{skip:s=0,limit:a=50}=e;return await p.get("/experiments",{skip:s,limit:a})}async getByUserId(e,s={}){const{skip:a=0,limit:t=50}=s;return await p.get(`/experiments/user/${e}`,{skip:a,limit:t})}async getById(e){return(await p.get(`/experiments/${e}`)).data}async getWithImages(e){return(await p.get(`/experiments/${e}/with-images`)).data}async create(e){return(await p.post("/experiments/",e)).data}async update(e,s){return(await p.patch(`/experiments/${e}`,s)).data}async delete(e){return await p.delete(`/experiments/${e}`)}async getByFilmId(e,s={}){const{skip:a=0,limit:t=50}=s;return await p.get(`/experiments/film/${e}`,{skip:a,limit:t})}async getByConfigId(e,s={}){const{skip:a=0,limit:t=50}=s;return await p.get(`/experiments/config/${e}`,{skip:a,limit:t})}};const K=new class{async getByExperimentId(e,s={}){const{skip:a=0,limit:t=100}=s;return await p.get(`/images/experiment/${e}`,{skip:a,limit:t})}async getById(e){return(await p.get(`/images/${e}`)).data}async upload(e,s,a=0){const t=new FormData;t.append("file",e);const i=`/images/upload?experiment_id=${s}&passes=${a}`;return(await p.postFormData(i,t)).data}async create(e){return(await p.post("/images",e)).data}async delete(e){return await p.delete(`/images/${e}`)}async deleteAllByExperiment(e){return await p.delete(`/images/experiment/${e}/all`)}fileToBase64(e){return new Promise((s,a)=>{const t=new FileReader;t.readAsDataURL(e),t.onload=()=>{const e=t.result.split(",")[1];s(e)},t.onerror=e=>a(e)})}createImageUrl(e,s="image/png"){return`data:${s};base64,${e}`}};const ee=new class{async getAll(e={}){const{skip:s=0,limit:a=100}=e;return await p.get("/films",{skip:s,limit:a})}async search(e,s={}){const{skip:a=0,limit:t=50}=s;return await p.get("/films/search",{name:e,skip:a,limit:t})}async getById(e){return(await p.get(`/films/${e}`)).data}async create(e){return(await p.post("/films",e)).data}async update(e,s){return(await p.patch(`/films/${e}`,s)).data}async delete(e){return await p.delete(`/films/${e}`)}};const se=new class{async getAll(e={}){const{skip:s=0,limit:a=100}=e;return await p.get("/equipment-configs",{skip:s,limit:a})}async search(e,s={}){const{skip:a=0,limit:t=50}=s;return await p.get("/equipment-configs/search",{name:e,skip:a,limit:t})}async getByHeadType(e,s={}){const{skip:a=0,limit:t=50}=s;return await p.get(`/equipment-configs/head-type/${e}`,{skip:a,limit:t})}async getById(e){return(await p.get(`/equipment-configs/${e}`)).data}async create(e){return(await p.post("/equipment-configs",e)).data}async update(e,s){return(await p.patch(`/equipment-configs/${e}`,s)).data}async delete(e){return await p.delete(`/equipment-configs/${e}`)}};const ae=new class{async analyzeScratchResistance(e,s=!0){return(await p.post(`/analysis/scratch-resistance?save_to_experiment=${s}`,e)).data}async getImageHistogram(e){return(await p.get(`/analysis/histogram/${e}`)).data}async quickExperimentAnalysis(e,s={}){const{skip:a=0,limit:t=100}=s;return(await p.get(`/analysis/experiment/${e}/quick-analysis`,{skip:a,limit:t})).data}};const te=new class{async getAll(e={}){const{skip:s=0,limit:a=50}=e;return await p.get("/users",{skip:s,limit:a})}async getById(e){return(await p.get(`/users/${e}`)).data}async getByUsername(e){return(await p.get(`/users/username/${e}`)).data}async update(e,s){return(await p.patch(`/users/${e}`,s)).data}async deactivate(e){return await p.post(`/users/${e}/deactivate`)}async delete(e){return await p.delete(`/users/${e}`)}},ie=(e,s={})=>{if(!e)return"-";const a={day:"2-digit",month:"long",year:"numeric",...s};return new Date(e).toLocaleDateString("ru-RU",a)},ne=(e,s=2)=>null==e?"-":(100*e).toFixed(s)+"%",re=e=>null==e?{label:"Нет данных",color:"muted"}:e<.05?{label:"Отлично",color:"success"}:e<.15?{label:"Хорошо",color:"success"}:e<.25?{label:"Удовлетворительно",color:"warning"}:e<.35?{label:"Плохо",color:"warning"}:{label:"Критично",color:"error"},le=e=>e?`${e} г`:"-",ce={page:"HBywVHEm",fadeInUp:"ipivU70l",header:"dYFuXFYT",titleSection:"wBIOkTcR",title:"LJME_kuC",titleAccent:"ZtTAJh5D",subtitle:"QBSG2GEo",count:"cNA7FIyZ",loadingContainer:"pGyq0ZBB",errorContainer:"umIt44Cc",errorContent:"Ne8rhhoV",errorIcon:"rujX0yOF",grid:"lPvKqKsP",experimentCard:"OuGktPr7",cardIndicator:"tKkVrRAk",success:"U6gycm2X",warning:"hBvrd7jR",error:"XcUozb6F",muted:"G39U4xml",cardContent:"y5cjhYTP",cardHeader:"pZIgU2lq",filmName:"jJVu8FxC",date:"bEdIucDh",configName:"gHQJHaHe",stats:"nEXflM7s",stat:"PATKbGD0",statLabel:"mAUjohVW",statValue:"MHHxB72r",qualityBadge:"QmVwImUk"};const de=function(){const[e,s]=(0,t.useState)([]),[a,i]=(0,t.useState)(!0),[n,l]=(0,t.useState)(null),{user:c}=v(),{error:d}=w(),o=(0,r.Zp)(),h=(0,t.useCallback)(async()=>{if(c?.id){i(!0),l(null);try{const e=await Q.getByUserId(c.id);s(e.data||[])}catch(e){l(e.message||"Ошибка загрузки экспериментов"),d("Не удалось загрузить эксперименты")}finally{i(!1)}}},[c?.id,d]);(0,t.useEffect)(()=>{h()},[h]);const u=()=>{o(m)};return(0,g.jsx)(R,{children:(0,g.jsxs)("div",{className:ce.page,children:[(0,g.jsxs)("div",{className:ce.header,children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h1",{className:ce.title,children:"Мои эксперименты"}),(0,g.jsx)("p",{className:ce.subtitle,children:"Управляйте вашими исследованиями устойчивости к царапинам"})]}),(0,g.jsxs)(M,{variant:"primary",onClick:u,children:[(0,g.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,g.jsx)("path",{d:"M8 2a.75.75 0 01.75.75v4.5h4.5a.75.75 0 010 1.5h-4.5v4.5a.75.75 0 01-1.5 0v-4.5h-4.5a.75.75 0 010-1.5h4.5v-4.5A.75.75 0 018 2z"})}),"Новый эксперимент"]})]}),a?(0,g.jsx)("div",{className:ce.loadingContainer,children:(0,g.jsx)(W,{size:"lg"})}):n?(0,g.jsx)("div",{className:ce.errorContainer,children:(0,g.jsx)(T,{variant:"outlined",padding:"lg",children:(0,g.jsxs)("div",{className:ce.errorContent,children:[(0,g.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"currentColor",className:ce.errorIcon,children:(0,g.jsx)("path",{fillRule:"evenodd",d:"M24 4C12.954 4 4 12.954 4 24s8.954 20 20 20 20-8.954 20-20S35.046 4 24 4zm-1.5 10a1.5 1.5 0 013 0v12a1.5 1.5 0 01-3 0V14zm1.5 20a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,g.jsx)("p",{children:n}),(0,g.jsx)(M,{variant:"secondary",onClick:h,children:"Попробовать снова"})]})})}):0===e.length?(0,g.jsx)(G,{icon:(0,g.jsxs)("svg",{viewBox:"0 0 48 48",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,g.jsx)("circle",{cx:"24",cy:"24",r:"20"}),(0,g.jsx)("path",{d:"M16 20h16M16 28h10M24 14v20",strokeLinecap:"round"})]}),title:"Нет экспериментов",description:"Создайте свой первый эксперимент для начала анализа",action:"Создать эксперимент",onAction:u}):(0,g.jsx)("div",{className:ce.grid,children:e.map(e=>{const s=(e=>{if(!e.scratch_results||0===e.scratch_results.length)return null;const s=e.scratch_results[e.scratch_results.length-1];return s?.scratch_index})(e),a=re(s);return(0,g.jsxs)(T,{variant:"default",padding:"none",hoverable:!0,onClick:()=>{return s=e.id,void o(`/experiments/${s}`);var s},className:ce.experimentCard,children:[(0,g.jsx)("div",{className:`${ce.cardIndicator} ${ce[a.color]}`}),(0,g.jsxs)("div",{className:ce.cardContent,children:[(0,g.jsxs)("div",{className:ce.cardHeader,children:[(0,g.jsx)("h3",{className:ce.filmName,children:e.film?.name||"Без названия"}),(0,g.jsx)("span",{className:ce.date,children:ie(e.date)})]}),(0,g.jsx)("p",{className:ce.configName,children:e.config?.name||"Конфигурация не указана"}),(0,g.jsxs)("div",{className:ce.stats,children:[(0,g.jsxs)("div",{className:ce.stat,children:[(0,g.jsx)("span",{className:ce.statLabel,children:"Вес"}),(0,g.jsx)("span",{className:ce.statValue,children:le(e.weight)})]}),(0,g.jsxs)("div",{className:ce.stat,children:[(0,g.jsx)("span",{className:ce.statLabel,children:"Абразив"}),(0,g.jsx)("span",{className:ce.statValue,children:e.has_fabric?"Да":"Нет"})]}),(0,g.jsxs)("div",{className:ce.stat,children:[(0,g.jsx)("span",{className:ce.statLabel,children:"Индекс"}),(0,g.jsx)("span",{className:`${ce.statValue} ${ce[a.color]}`,children:null!==s?ne(s):"—"})]})]}),null!==s&&(0,g.jsx)("div",{className:`${ce.qualityBadge} ${ce[a.color]}`,children:a.label})]})]},e.id)})})]})})},oe="PIHoEJUR";function he({imageSrc:e,onSelectionChange:s,initialSelection:a=null}){const i=(0,t.useRef)(null),n=(0,t.useRef)(null),r=(0,t.useRef)(null),[l,c]=(0,t.useState)(!1),[d,o]=(0,t.useState)(null),[h,m]=(0,t.useState)(a),[u,p]=(0,t.useState)(!1),[,x]=(0,t.useState)({width:0,height:0}),j=(0,t.useCallback)(e=>{const s=n.current,a=s.getBoundingClientRect(),t=s.width/a.width,i=s.height/a.height;return{x:(e.clientX-a.left)*t,y:(e.clientY-a.top)*i}},[]),f=(0,t.useCallback)(e=>{const s=n.current,a=s.getContext("2d"),t=r.current;a.clearRect(0,0,s.width,s.height),t&&u&&a.drawImage(t,0,0,s.width,s.height),e&&(a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(0,0,s.width,e.y),a.fillRect(0,e.y+e.height,s.width,s.height-e.y-e.height),a.fillRect(0,e.y,e.x,e.height),a.fillRect(e.x+e.width,e.y,s.width-e.x-e.width,e.height),a.strokeStyle="#00d4ff",a.lineWidth=2,a.setLineDash([6,4]),a.strokeRect(e.x,e.y,e.width,e.height),a.setLineDash([]),a.fillStyle="#00d4ff",[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height}].forEach(({x:e,y:s})=>{a.fillRect(e-4,s-4,8,8)}))},[u]);(0,t.useEffect)(()=>{if(!e)return;const s=new Image;s.onload=()=>{r.current=s,x({width:s.width,height:s.height}),p(!0)},s.src=e},[e]),(0,t.useEffect)(()=>{if(!u||!i.current||!n.current)return;const e=i.current,s=n.current,a=r.current,t=e.clientWidth,l=a.width/a.height,c=Math.min(500,t/l),d=c*l;s.width=a.width,s.height=a.height,s.style.width=`${d}px`,s.style.height=`${c}px`,f(h)},[u,h,f]);const v=()=>{if(l&&h&&h.width>10&&h.height>10){const e=[Math.round(h.x),Math.round(h.y),Math.round(h.width),Math.round(h.height)];s?.(e)}c(!1)};return(0,g.jsxs)("div",{className:"qsK7PXz1",ref:i,children:[(0,g.jsxs)("div",{className:"s1W9yhXs",children:[(0,g.jsx)("canvas",{ref:n,className:"iVSZgSrp",onMouseDown:e=>{const s=j(e);c(!0),o(s)},onMouseMove:e=>{if(!l||!d)return;const s=j(e),a={x:Math.min(d.x,s.x),y:Math.min(d.y,s.y),width:Math.abs(s.x-d.x),height:Math.abs(s.y-d.y)};m(a),f(a)},onMouseUp:v,onMouseLeave:v}),!u&&(0,g.jsx)("div",{className:"THSklS88",children:"Загрузка изображения..."})]}),(0,g.jsx)("div",{className:"rSH1J_Z4",children:h?(0,g.jsxs)("div",{className:"jnmDRQsS",children:[(0,g.jsx)("span",{className:"hMTEFmRj",children:"Выбранная область:"}),(0,g.jsxs)("span",{className:oe,children:["X: ",Math.round(h.x)]}),(0,g.jsxs)("span",{className:oe,children:["Y: ",Math.round(h.y)]}),(0,g.jsxs)("span",{className:oe,children:["Ширина: ",Math.round(h.width)]}),(0,g.jsxs)("span",{className:oe,children:["Высота: ",Math.round(h.height)]}),(0,g.jsx)(M,{variant:"ghost",size:"sm",onClick:()=>{m(null),o(null),s?.(null),f(null)},children:"Очистить выбор"})]}):(0,g.jsx)("p",{className:"nou6z7vq",children:"Нажмите и перетащите на изображении, чтобы выбрать область интереса"})})]})}he.propTypes={imageSrc:L().string.isRequired,onSelectionChange:L().func,initialSelection:L().shape({x:L().number,y:L().number,width:L().number,height:L().number})};const me="clS1odFZ",ue="Lhm_R5aP",pe="xTDThb4M",xe="eXq3r0NJ",ge=[{id:1,title:"Конфигурация",description:"Параметры эксперимента"},{id:2,title:"Изображение",description:"Загрузка эталонного снимка"},{id:3,title:"Область",description:"Выбор области анализа"}];const je=function(){const[e,s]=(0,t.useState)(1),[a,i]=(0,t.useState)(!1),[n,l]=(0,t.useState)(!1),[c,d]=(0,t.useState)([]),[o,h]=(0,t.useState)([]),[m,u]=(0,t.useState)({filmId:"",configId:"",weight:"",hasFabric:!1}),[p,x]=(0,t.useState)(null),[j,f]=(0,t.useState)(null),[y,b]=(0,t.useState)(null),[N,k]=(0,t.useState)({}),{user:C}=v(),{success:_,error:S}=w(),L=(0,r.Zp)();(0,t.useEffect)(()=>{(async()=>{i(!0);try{const[e,s]=await Promise.all([ee.getAll(),se.getAll()]);d(e.data||[]),h(s.data||[])}catch(e){S("Ошибка загрузки данных")}finally{i(!1)}})()},[S]);const I=e=>{const{name:s,value:a,type:t,checked:i}=e.target;u(e=>({...e,[s]:"checkbox"===t?i:a})),N[s]&&k(e=>({...e,[s]:""}))},B=(0,t.useCallback)(e=>{b(e),N.roi&&k(e=>({...e,roi:""}))},[N.roi]),$=()=>{const s={};return 1===e&&(m.filmId||(s.filmId="Выберите тип пленки"),m.configId||(s.configId="Выберите конфигурацию"),(!m.weight||parseFloat(m.weight)<=0)&&(s.weight="Введите корректный вес")),2===e&&(p||(s.image="Загрузите изображение")),3===e&&(y||(s.roi="Выберите область анализа")),k(s),0===Object.keys(s).length},z=c.map(e=>({value:e.id,label:e.name+(e.coating_name?` (${e.coating_name})`:"")})),E=o.map(e=>({value:e.id,label:e.name+(e.head_type?` - ${e.head_type}`:"")}));return a?(0,g.jsx)(R,{children:(0,g.jsx)("div",{className:"abJMk6X_",children:(0,g.jsx)(W,{size:"lg"})})}):(0,g.jsx)(R,{children:(0,g.jsxs)("div",{className:"GDnvotoF",children:[(0,g.jsxs)("div",{className:"bQ6V0pUi",children:[(0,g.jsx)("h1",{className:"fkXnD3nY",children:"Создать эксперимент"}),(0,g.jsx)("p",{className:"AYAZJrOI",children:"Настройте параметры теста на устойчивость к царапинам"})]}),(0,g.jsx)("div",{className:"LswUl_PN",children:ge.map((s,a)=>(0,g.jsxs)("div",{className:`hCc_DoNz ${e>=s.id?"YOb8ZPGI":""} ${e>s.id?"bTQLGsYa":""}`,children:[(0,g.jsx)("div",{className:"fbp4PXin",children:e>s.id?(0,g.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,g.jsx)("path",{d:"M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"})}):s.id}),(0,g.jsx)("div",{className:"dsV5ZMAe",children:(0,g.jsx)("span",{className:"ftX3NB0e",children:s.title})}),a<ge.length-1&&(0,g.jsx)("div",{className:"lk5MwlVd"})]},s.id))}),(0,g.jsxs)(T,{variant:"default",padding:"lg",className:"HZiadzGF",children:[1===e&&(0,g.jsxs)("div",{className:me,children:[(0,g.jsx)("h2",{className:ue,children:"Параметры эксперимента"}),(0,g.jsx)("p",{className:pe,children:"Выберите тип пленки, конфигурацию оборудования и укажите параметры теста"}),(0,g.jsxs)("div",{className:"aL1i5sXJ",children:[(0,g.jsx)(q,{name:"filmId",label:"Тип пленки",options:z,value:m.filmId,onChange:I,error:N.filmId,required:!0,placeholder:"Выберите тип пленки"}),(0,g.jsx)(q,{name:"configId",label:"Конфигурация оборудования",options:E,value:m.configId,onChange:I,error:N.configId,required:!0,placeholder:"Выберите конфигурацию"}),(0,g.jsx)(O,{name:"weight",type:"number",label:"Вес груза (г)",placeholder:"Например: 500",value:m.weight,onChange:I,error:N.weight,required:!0,min:"0",step:"0.1"}),(0,g.jsx)("div",{className:"g1lyDKzd",children:(0,g.jsx)(A,{name:"hasFabric",label:"Использовать абразивную ткань",checked:m.hasFabric,onChange:I})})]})]}),2===e&&(0,g.jsxs)("div",{className:me,children:[(0,g.jsx)("h2",{className:ue,children:"Загрузка эталонного изображения"}),(0,g.jsx)("p",{className:pe,children:"Загрузите фотографию чистой (незацарапанной) пленки"}),(0,g.jsxs)("div",{className:"H39X3FZw",children:[(0,g.jsx)("input",{type:"file",id:"imageUpload",accept:"image/jpeg,image/png,image/webp",onChange:e=>{const s=e.target.files?.[0];if(!s)return;const a=D(s);if(!a.isValid)return void k(e=>({...e,image:a.errors[0]}));x(s),k(e=>({...e,image:""}));const t=new FileReader;t.onload=()=>{f(t.result)},t.readAsDataURL(s)},className:"_8HF1nZu"}),j?(0,g.jsxs)("div",{className:"raWFzJAd",children:[(0,g.jsx)("img",{src:j,alt:"Preview"}),(0,g.jsx)("div",{className:"Q0jpePYo",children:(0,g.jsx)("label",{htmlFor:"imageUpload",className:"dR64Hj0a",children:"Изменить"})})]}):(0,g.jsxs)("label",{htmlFor:"imageUpload",className:"UZ0Qe8PY",children:[(0,g.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,g.jsx)("rect",{x:"6",y:"10",width:"36",height:"28",rx:"4"}),(0,g.jsx)("circle",{cx:"18",cy:"22",r:"4"}),(0,g.jsx)("path",{d:"M42 30l-8-8-12 12-6-6-10 10",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,g.jsx)("span",{className:"MysP6Mwe",children:"Нажмите или перетащите изображение"}),(0,g.jsx)("span",{className:"ghU9yLTk",children:"JPEG, PNG или WebP до 10 МБ"})]}),N.image&&(0,g.jsx)("span",{className:xe,children:N.image})]})]}),3===e&&(0,g.jsxs)("div",{className:me,children:[(0,g.jsx)("h2",{className:ue,children:"Выбор области анализа"}),(0,g.jsx)("p",{className:pe,children:"Нарисуйте прямоугольник на изображении для определения области анализа"}),j&&(0,g.jsx)(he,{imageSrc:j,onSelectionChange:B,initialSelection:y?{x:y[0],y:y[1],width:y[2],height:y[3]}:null}),N.roi&&(0,g.jsx)("span",{className:xe,children:N.roi})]})]}),(0,g.jsxs)("div",{className:"dr95UmzW",children:[e>1&&(0,g.jsx)(M,{variant:"secondary",onClick:()=>{s(e=>e-1)},children:"Назад"}),(0,g.jsx)("div",{className:"jhwvPGwS"}),e<ge.length?(0,g.jsx)(M,{variant:"primary",onClick:()=>{$()&&s(e=>e+1)},children:"Далее"}):(0,g.jsx)(M,{variant:"primary",onClick:async()=>{if($()){l(!0);try{const e={film_id:m.filmId,config_id:m.configId,user_id:C.id,date:(new Date).toISOString(),weight:parseFloat(m.weight),has_fabric:m.hasFabric,rect_coords:y},s=await Q.create(e);await K.upload(p,s.id,0),_("Эксперимент успешно создан"),L(`/experiments/${s.id}`)}catch(e){S(e.message||"Ошибка создания эксперимента")}finally{l(!1)}}},loading:n,children:"Создать эксперимент"})]})]})})};var fe=a(106),ve=a(731);function ye({data:e,title:s="Индекс царапины"}){const a=(0,t.useMemo)(()=>{if(!e||0===e.length)return null;const s=[...e].sort((e,s)=>e.passes-s.passes);return{labels:s.map(e=>`${e.passes} прох.`),datasets:[{label:"Индекс царапины",data:s.map(e=>100*e.scratch_index),borderColor:"#00d4ff",backgroundColor:"rgba(0, 212, 255, 0.1)",borderWidth:2,pointRadius:6,pointHoverRadius:8,pointBackgroundColor:"#00d4ff",pointBorderColor:"#0a1628",pointBorderWidth:2,tension:.3,fill:!0}]}},[e]),i=(0,t.useMemo)(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!!s,text:s,color:"#f1f5f9",font:{family:"'Inter', sans-serif",size:14,weight:"600"},padding:{bottom:16}},tooltip:{backgroundColor:"#1e293b",titleColor:"#f1f5f9",bodyColor:"#94a3b8",borderColor:"#334155",borderWidth:1,cornerRadius:8,padding:12,displayColors:!1,callbacks:{title:s=>`Проходов: ${e[s[0].dataIndex]?.passes||0}`,label:e=>`Индекс: ${e.raw.toFixed(2)}%`}}},scales:{x:{grid:{color:"rgba(51, 65, 85, 0.5)",drawBorder:!1},ticks:{color:"#94a3b8",font:{family:"'Inter', sans-serif",size:12}}},y:{grid:{color:"rgba(51, 65, 85, 0.5)",drawBorder:!1},ticks:{color:"#94a3b8",font:{family:"'Inter', sans-serif",size:12},callback:e=>`${e}%`},min:0,suggestedMax:50}},interaction:{intersect:!1,mode:"index"}}),[s,e]);return a?(0,g.jsx)("div",{className:"IeK4DfEs",children:(0,g.jsx)(ve.N1,{data:a,options:i})}):(0,g.jsx)("div",{className:"h_XhNsUS",children:(0,g.jsx)("p",{children:"Нет данных для отображения"})})}fe.t1.register(fe.PP,fe.kc,fe.FN,fe.No,fe.hE,fe.m_,fe.s$,fe.dN),ye.propTypes={data:L().arrayOf(L().shape({passes:L().number.isRequired,scratch_index:L().number.isRequired})),title:L().string};const be="QX6OXbFz";function Ne({images:e=[],onImageClick:s}){const[a,i]=(0,t.useState)(0),n=(0,t.useMemo)(()=>[...e].sort((e,s)=>e.passes-s.passes),[e]),r=n[a],l=()=>{i(e=>e>0?e-1:n.length-1)},c=()=>{i(e=>e<n.length-1?e+1:0)};if(0===n.length)return(0,g.jsxs)("div",{className:"w8n0xTFf",children:[(0,g.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,g.jsx)("rect",{x:"6",y:"10",width:"36",height:"28",rx:"4"}),(0,g.jsx)("circle",{cx:"18",cy:"22",r:"4"}),(0,g.jsx)("path",{d:"M42 30l-8-8-12 12-6-6-10 10",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,g.jsx)("p",{children:"Нет изображений"})]});const d=e=>e?"string"==typeof e&&e.startsWith("data:")?e:K.createImageUrl(e):"";return(0,g.jsxs)("div",{className:"QJbGQ6Ym",tabIndex:0,onKeyDown:e=>{"ArrowLeft"===e.key&&l(),"ArrowRight"===e.key&&c()},children:[(0,g.jsxs)("div",{className:"yDH1Mcnh",children:[(0,g.jsx)("img",{src:d(r?.image_data),alt:`Проходов: ${r?.passes||0}`,onClick:()=>s?.(r)}),n.length>1&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{className:`${be} s2LCI8TS`,onClick:l,"aria-label":"Предыдущее",children:(0,g.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,g.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})}),(0,g.jsx)("button",{className:`${be} cL8Yn1ib`,onClick:c,"aria-label":"Следующее",children:(0,g.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,g.jsx)("path",{d:"M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"})})})]}),(0,g.jsxs)("div",{className:"FeKobZ5R",children:[(0,g.jsx)("span",{className:"QSRbFSyn",children:0===r?.passes?"Эталон":`${r?.passes} проходов`}),(0,g.jsxs)("span",{className:"bEARzvO3",children:[a+1," / ",n.length]})]})]}),n.length>1&&(0,g.jsx)("div",{className:"riU_WuOp",children:n.map((e,s)=>(0,g.jsxs)("button",{className:"sRU9K5H1 "+(s===a?"YAIqdTUH":""),onClick:()=>(e=>{i(e)})(s),"aria-label":`Изображение ${s+1}`,children:[(0,g.jsx)("img",{src:d(e.image_data),alt:`Проходов: ${e.passes}`}),(0,g.jsx)("span",{className:"vPAHQUMe",children:0===e.passes?"Эт.":e.passes})]},e.id))})]})}Ne.propTypes={images:L().arrayOf(L().shape({id:L().string.isRequired,passes:L().number.isRequired,image_data:L().string})),onImageClick:L().func};const we={page:"bjOVuXc3",fadeIn:"K4eF3OlD",loadingContainer:"Vnff17tE",errorContainer:"IwqyS0nu",header:"obxj6_BX",headerInfo:"QmcrhkC7",backButton:"BStn4Y_q",title:"NFb5RfHh",subtitle:"fTaXExTS",headerActions:"vrvxYTL8",statsGrid:"jwrJWbKy",statCard:"p46af_IG",statLabel:"sgi8whF2",statValue:"jnZLeoS1",success:"fYbDXy5W",warning:"Z0lPEMoS",error:"CQ2TEZpk",content:"IpT1liC6",sectionTitle:"RNmYm3Ut",emptyChart:"ciq0Ewi9",resultsTable:"jmNRqyHN",tableHeader:"t20SPBgg",tableRow:"bZJwXbnD",mono:"ZM8Wq4FX",badge:"jbcM43o2",muted:"XSN9_db7",modalContent:"qvGsjnm7",fileInput:"yJk8HGsR",uploadArea:"CxVGCAXx",uploadLabel:"EFPxt0js",selectedFile:"O6hTV5mC",removeFile:"TXxxUsdD",modalActions:"yHcCbGIg"};const ke=function(){const{id:e}=(0,r.g)(),s=(0,r.Zp)(),{success:a,error:i}=w(),[n,l]=(0,t.useState)(null),[c,d]=(0,t.useState)([]),[o,m]=(0,t.useState)(!0),[u,p]=(0,t.useState)(!1),[x,j]=(0,t.useState)(!1),[f,v]=(0,t.useState)(null),[y,b]=(0,t.useState)(""),[N,k]=(0,t.useState)(!1),C=(0,t.useCallback)(async()=>{m(!0);try{const[s,a]=await Promise.all([Q.getById(e),K.getByExperimentId(e)]);l(s),d(a.data||[])}catch(e){i("Ошибка загрузки эксперимента"),s(h)}finally{m(!1)}},[e,s,i]);(0,t.useEffect)(()=>{C()},[C]);const _=n?.scratch_results?.map(e=>{const s=c.find(s=>s.id===e.image_id);return{passes:s?.passes||0,scratch_index:e.scratch_index}}).filter(e=>e.passes>0)||[],S=n?.scratch_results?.length>0?n.scratch_results[n.scratch_results.length-1]:null,L=re(S?.scratch_index);return o?(0,g.jsx)(R,{children:(0,g.jsx)("div",{className:we.loadingContainer,children:(0,g.jsx)(W,{size:"lg"})})}):n?(0,g.jsx)(R,{children:(0,g.jsxs)("div",{className:we.page,children:[(0,g.jsxs)("div",{className:we.header,children:[(0,g.jsxs)("div",{className:we.headerInfo,children:[(0,g.jsxs)("button",{className:we.backButton,onClick:()=>s(h),children:[(0,g.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:(0,g.jsx)("path",{fillRule:"evenodd",d:"M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z",clipRule:"evenodd"})}),"Назад"]}),(0,g.jsx)("h1",{className:we.title,children:n.film?.name||"Эксперимент"}),(0,g.jsxs)("p",{className:we.subtitle,children:[n.config?.name," | ",ie(n.date)]})]}),(0,g.jsxs)("div",{className:we.headerActions,children:[(0,g.jsxs)(M,{variant:"secondary",onClick:()=>j(!0),children:[(0,g.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:(0,g.jsx)("path",{d:"M8 2a.75.75 0 01.75.75v4.5h4.5a.75.75 0 010 1.5h-4.5v4.5a.75.75 0 01-1.5 0v-4.5h-4.5a.75.75 0 010-1.5h4.5v-4.5A.75.75 0 018 2z"})}),"Добавить фото"]}),(0,g.jsx)(M,{variant:"primary",onClick:async()=>{if(c.length<2)return void i("Необходимо минимум 2 изображения (эталон + царапины)");const s=c.find(e=>0===e.passes),t=c.filter(e=>e.passes>0);if(s)if(0!==t.length){p(!0);try{await ae.analyzeScratchResistance({experiment_id:e,reference_image_id:s.id,scratched_image_ids:t.map(e=>e.id)}),a("Анализ завершен"),C()}catch(e){i(e.message||"Ошибка анализа")}finally{p(!1)}}else i("Добавьте изображения с царапинами");else i("Не найдено эталонное изображение (passes = 0)")},loading:u,disabled:c.length<2,children:"Запустить анализ"})]})]}),(0,g.jsxs)("div",{className:we.statsGrid,children:[(0,g.jsxs)(T,{variant:"default",padding:"md",className:we.statCard,children:[(0,g.jsx)("span",{className:we.statLabel,children:"Вес груза"}),(0,g.jsx)("span",{className:we.statValue,children:le(n.weight)})]}),(0,g.jsxs)(T,{variant:"default",padding:"md",className:we.statCard,children:[(0,g.jsx)("span",{className:we.statLabel,children:"Абразив"}),(0,g.jsx)("span",{className:we.statValue,children:n.has_fabric?"Да":"Нет"})]}),(0,g.jsxs)(T,{variant:"default",padding:"md",className:we.statCard,children:[(0,g.jsx)("span",{className:we.statLabel,children:"Изображений"}),(0,g.jsx)("span",{className:we.statValue,children:c.length})]}),(0,g.jsxs)(T,{variant:"default",padding:"md",className:we.statCard,children:[(0,g.jsx)("span",{className:we.statLabel,children:"Индекс"}),(0,g.jsx)("span",{className:`${we.statValue} ${we[L.color]}`,children:S?ne(S.scratch_index):"—"})]})]}),(0,g.jsxs)("div",{className:we.content,children:[(0,g.jsxs)(T,{variant:"default",padding:"md",children:[(0,g.jsx)("h2",{className:we.sectionTitle,children:"Изображения"}),(0,g.jsx)(Ne,{images:c})]}),(0,g.jsxs)(T,{variant:"default",padding:"md",children:[(0,g.jsx)("h2",{className:we.sectionTitle,children:"График индекса царапины"}),_.length>0?(0,g.jsx)(ye,{data:_,title:""}):(0,g.jsx)("div",{className:we.emptyChart,children:(0,g.jsx)("p",{children:"Запустите анализ для отображения графика"})})]}),n.scratch_results&&n.scratch_results.length>0&&(0,g.jsxs)(T,{variant:"default",padding:"md",children:[(0,g.jsx)("h2",{className:we.sectionTitle,children:"Результаты анализа"}),(0,g.jsxs)("div",{className:we.resultsTable,children:[(0,g.jsxs)("div",{className:we.tableHeader,children:[(0,g.jsx)("span",{children:"Проходов"}),(0,g.jsx)("span",{children:"Индекс царапины"}),(0,g.jsx)("span",{children:"Качество"})]}),n.scratch_results.map(e=>{const s=c.find(s=>s.id===e.image_id),a=re(e.scratch_index);return(0,g.jsxs)("div",{className:we.tableRow,children:[(0,g.jsx)("span",{children:s?.passes||"—"}),(0,g.jsx)("span",{className:we.mono,children:ne(e.scratch_index)}),(0,g.jsx)("span",{className:`${we.badge} ${we[a.color]}`,children:a.label})]},e.image_id)})]})]})]}),(0,g.jsx)(P,{isOpen:x,onClose:()=>j(!1),title:"Добавить изображение",size:"md",children:(0,g.jsxs)("div",{className:we.modalContent,children:[(0,g.jsxs)("div",{className:we.uploadArea,children:[(0,g.jsx)("input",{type:"file",id:"addImageUpload",accept:"image/jpeg,image/png,image/webp",onChange:e=>{const s=e.target.files?.[0];if(!s)return;const a=D(s);a.isValid?v(s):i(a.errors[0])},className:we.fileInput}),f?(0,g.jsxs)("div",{className:we.selectedFile,children:[(0,g.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,g.jsx)("path",{d:"M5 21q-.825 0-1.413-.587Q3 19.825 3 19V5q0-.825.587-1.413Q4.175 3 5 3h14q.825 0 1.413.587Q21 4.175 21 5v14q0 .825-.587 1.413Q19.825 21 19 21Zm0-2h14V5H5v14Zm1-2h12l-3.75-5-3 4L9 13Z"})}),(0,g.jsx)("span",{children:f.name}),(0,g.jsx)("button",{type:"button",onClick:()=>v(null),className:we.removeFile,children:"×"})]}):(0,g.jsxs)("label",{htmlFor:"addImageUpload",className:we.uploadLabel,children:[(0,g.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[(0,g.jsx)("rect",{x:"4",y:"6",width:"24",height:"20",rx:"3"}),(0,g.jsx)("circle",{cx:"12",cy:"14",r:"3"}),(0,g.jsx)("path",{d:"M28 20l-6-6-8 8-4-4-6 6",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,g.jsx)("span",{children:"Выберите изображение"})]})]}),(0,g.jsx)(O,{type:"number",label:"Количество проходов",placeholder:"Например: 5, 10, 15...",value:y,onChange:e=>b(e.target.value),min:"1"}),(0,g.jsxs)("div",{className:we.modalActions,children:[(0,g.jsx)(M,{variant:"secondary",onClick:()=>j(!1),children:"Отмена"}),(0,g.jsx)(M,{variant:"primary",onClick:async()=>{if(!f||!y)return void i("Заполните все поля");const s=parseInt(y,10);if(isNaN(s)||s<1)i("Введите корректное количество проходов");else{k(!0);try{await K.upload(f,e,s),a("Изображение добавлено"),j(!1),v(null),b(""),C()}catch(e){i(e.message||"Ошибка загрузки изображения")}finally{k(!1)}}},loading:N,disabled:!f||!y,children:"Добавить"})]})]})})]})}):(0,g.jsx)(R,{children:(0,g.jsxs)("div",{className:we.errorContainer,children:[(0,g.jsx)("p",{children:"Эксперимент не найден"}),(0,g.jsx)(M,{variant:"secondary",onClick:()=>s(h),children:"К списку экспериментов"})]})})},Ce="LZp9885s",_e="TloJMFOZ",Se="bdKk0GKe",Le="_30KF5BK",Re="J_hEF4fQ",Ie="VvA9SoBt",Me="qeHLDlLy",Be="n1B9ec_D",Oe="TLZqJAwe";function $e(){const[e,s]=(0,t.useState)([]),[a,i]=(0,t.useState)(!0),[n,r]=(0,t.useState)(null),[l,c]=(0,t.useState)(!1),[d,o]=(0,t.useState)({email:"",is_active:!0}),[h,m]=(0,t.useState)(!1),{success:u,error:p}=w(),x=(0,t.useCallback)(async()=>{i(!0);try{const e=await te.getAll();s(e.data||[])}catch(e){p("Ошибка загрузки пользователей")}finally{i(!1)}},[p]);return(0,t.useEffect)(()=>{x()},[x]),a?(0,g.jsx)("div",{className:_e,children:(0,g.jsx)(W,{size:"lg"})}):(0,g.jsxs)("div",{className:Ce,children:[(0,g.jsx)("div",{className:Le,children:(0,g.jsxs)("table",{className:Re,children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Имя пользователя"}),(0,g.jsx)("th",{children:"Email"}),(0,g.jsx)("th",{children:"Роли"}),(0,g.jsx)("th",{children:"Статус"}),(0,g.jsx)("th",{children:"Действия"})]})}),(0,g.jsx)("tbody",{children:e.map(e=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:Ie,children:e.username}),(0,g.jsx)("td",{children:e.email}),(0,g.jsx)("td",{children:e.roles?.map(e=>(0,g.jsx)("span",{className:"FIKincqi",children:e.name},e.id))}),(0,g.jsx)("td",{children:(0,g.jsx)("span",{className:"dfFdR4AH "+(e.is_active?"JRcaK6y2":"adyusGEQ"),children:e.is_active?"Активен":"Неактивен"})}),(0,g.jsx)("td",{children:(0,g.jsxs)("div",{className:Me,children:[(0,g.jsx)(M,{variant:"ghost",size:"sm",onClick:()=>(e=>{r(e),o({email:e.email,is_active:e.is_active}),c(!0)})(e),children:"Изменить"}),e.is_active&&(0,g.jsx)(M,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(window.confirm("Деактивировать пользователя?"))try{await te.deactivate(e),u("Пользователь деактивирован"),x()}catch(e){p(e.message||"Ошибка деактивации")}})(e.id),children:"Деактивировать"})]})})]},e.id))})]})}),(0,g.jsx)(P,{isOpen:l,onClose:()=>c(!1),title:"Редактирование пользователя",size:"sm",children:(0,g.jsxs)("div",{className:Be,children:[(0,g.jsx)(O,{label:"Email",type:"email",value:d.email,onChange:e=>o(s=>({...s,email:e.target.value}))}),(0,g.jsxs)("label",{className:"kJSWiNAo",children:[(0,g.jsx)("input",{type:"checkbox",checked:d.is_active,onChange:e=>o(s=>({...s,is_active:e.target.checked}))}),(0,g.jsx)("span",{children:"Активен"})]}),(0,g.jsxs)("div",{className:Oe,children:[(0,g.jsx)(M,{variant:"secondary",onClick:()=>c(!1),children:"Отмена"}),(0,g.jsx)(M,{variant:"primary",onClick:async()=>{if(n){m(!0);try{await te.update(n.id,d),u("Пользователь обновлен"),c(!1),x()}catch(e){p(e.message||"Ошибка обновления")}finally{m(!1)}}},loading:h,children:"Сохранить"})]})]})})]})}function qe(){const[e,s]=(0,t.useState)([]),[a,i]=(0,t.useState)(!0),[n,r]=(0,t.useState)(null),[l,c]=(0,t.useState)(!1),[d,o]=(0,t.useState)(!1),[h,m]=(0,t.useState)({name:"",coating_name:"",coating_thickness:""}),[u,p]=(0,t.useState)(!1),{success:x,error:j}=w(),f=(0,t.useCallback)(async()=>{i(!0);try{const e=await ee.getAll();s(e.data||[])}catch(e){j("Ошибка загрузки типов пленок")}finally{i(!1)}},[j]);return(0,t.useEffect)(()=>{f()},[f]),a?(0,g.jsx)("div",{className:_e,children:(0,g.jsx)(W,{size:"lg"})}):(0,g.jsxs)("div",{className:Ce,children:[(0,g.jsx)("div",{className:Se,children:(0,g.jsx)(M,{variant:"primary",onClick:()=>{r(null),m({name:"",coating_name:"",coating_thickness:""}),o(!0),c(!0)},children:"Добавить тип пленки"})}),(0,g.jsx)("div",{className:Le,children:(0,g.jsxs)("table",{className:Re,children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Название"}),(0,g.jsx)("th",{children:"Покрытие"}),(0,g.jsx)("th",{children:"Толщина покрытия"}),(0,g.jsx)("th",{children:"Действия"})]})}),(0,g.jsx)("tbody",{children:e.map(e=>{return(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:Ie,children:e.name}),(0,g.jsx)("td",{children:e.coating_name||"—"}),(0,g.jsx)("td",{children:(s=e.coating_thickness,s?`${s} мкм`:"-")}),(0,g.jsx)("td",{children:(0,g.jsxs)("div",{className:Me,children:[(0,g.jsx)(M,{variant:"ghost",size:"sm",onClick:()=>(e=>{r(e),m({name:e.name,coating_name:e.coating_name||"",coating_thickness:e.coating_thickness||""}),o(!1),c(!0)})(e),children:"Изменить"}),(0,g.jsx)(M,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(window.confirm("Удалить тип пленки?"))try{await ee.delete(e),x("Тип пленки удален"),f()}catch(e){j(e.message||"Ошибка удаления")}})(e.id),children:"Удалить"})]})})]},e.id);var s})})]})}),(0,g.jsx)(P,{isOpen:l,onClose:()=>c(!1),title:d?"Добавить тип пленки":"Редактировать тип пленки",size:"sm",children:(0,g.jsxs)("div",{className:Be,children:[(0,g.jsx)(O,{label:"Название",value:h.name,onChange:e=>m(s=>({...s,name:e.target.value})),required:!0}),(0,g.jsx)(O,{label:"Название покрытия",value:h.coating_name,onChange:e=>m(s=>({...s,coating_name:e.target.value}))}),(0,g.jsx)(O,{label:"Толщина покрытия (мкм)",type:"number",value:h.coating_thickness,onChange:e=>m(s=>({...s,coating_thickness:e.target.value})),min:"0",step:"0.1"}),(0,g.jsxs)("div",{className:Oe,children:[(0,g.jsx)(M,{variant:"secondary",onClick:()=>c(!1),children:"Отмена"}),(0,g.jsx)(M,{variant:"primary",onClick:async()=>{if(h.name){p(!0);try{const e={name:h.name,coating_name:h.coating_name||null,coating_thickness:h.coating_thickness?parseFloat(h.coating_thickness):null};d?(await ee.create(e),x("Тип пленки создан")):(await ee.update(n.id,e),x("Тип пленки обновлен")),c(!1),f()}catch(e){j(e.message||"Ошибка сохранения")}finally{p(!1)}}else j("Введите название")},loading:u,children:d?"Создать":"Сохранить"})]})]})})]})}function Ae(){const[e,s]=(0,t.useState)([]),[a,i]=(0,t.useState)(!0),[n,r]=(0,t.useState)(null),[l,c]=(0,t.useState)(!1),[d,o]=(0,t.useState)(!1),[h,m]=(0,t.useState)({name:"",head_type:"",description:""}),[u,p]=(0,t.useState)(!1),{success:x,error:j}=w(),f=(0,t.useCallback)(async()=>{i(!0);try{const e=await se.getAll();s(e.data||[])}catch(e){j("Ошибка загрузки конфигураций")}finally{i(!1)}},[j]);return(0,t.useEffect)(()=>{f()},[f]),a?(0,g.jsx)("div",{className:_e,children:(0,g.jsx)(W,{size:"lg"})}):(0,g.jsxs)("div",{className:Ce,children:[(0,g.jsx)("div",{className:Se,children:(0,g.jsx)(M,{variant:"primary",onClick:()=>{r(null),m({name:"",head_type:"",description:""}),o(!0),c(!0)},children:"Добавить конфигурацию"})}),(0,g.jsx)("div",{className:Le,children:(0,g.jsxs)("table",{className:Re,children:[(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Название"}),(0,g.jsx)("th",{children:"Тип головки"}),(0,g.jsx)("th",{children:"Описание"}),(0,g.jsx)("th",{children:"Действия"})]})}),(0,g.jsx)("tbody",{children:e.map(e=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:Ie,children:e.name}),(0,g.jsx)("td",{children:e.head_type||"—"}),(0,g.jsx)("td",{className:"wYUwdrlO",children:e.description||"—"}),(0,g.jsx)("td",{children:(0,g.jsxs)("div",{className:Me,children:[(0,g.jsx)(M,{variant:"ghost",size:"sm",onClick:()=>(e=>{r(e),m({name:e.name,head_type:e.head_type||"",description:e.description||""}),o(!1),c(!0)})(e),children:"Изменить"}),(0,g.jsx)(M,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(window.confirm("Удалить конфигурацию?"))try{await se.delete(e),x("Конфигурация удалена"),f()}catch(e){j(e.message||"Ошибка удаления")}})(e.id),children:"Удалить"})]})})]},e.id))})]})}),(0,g.jsx)(P,{isOpen:l,onClose:()=>c(!1),title:d?"Добавить конфигурацию":"Редактировать конфигурацию",size:"sm",children:(0,g.jsxs)("div",{className:Be,children:[(0,g.jsx)(O,{label:"Название",value:h.name,onChange:e=>m(s=>({...s,name:e.target.value})),required:!0}),(0,g.jsx)(O,{label:"Тип головки",value:h.head_type,onChange:e=>m(s=>({...s,head_type:e.target.value}))}),(0,g.jsx)(O,{label:"Описание",value:h.description,onChange:e=>m(s=>({...s,description:e.target.value}))}),(0,g.jsxs)("div",{className:Oe,children:[(0,g.jsx)(M,{variant:"secondary",onClick:()=>c(!1),children:"Отмена"}),(0,g.jsx)(M,{variant:"primary",onClick:async()=>{if(h.name){p(!0);try{const e={name:h.name,head_type:h.head_type||null,description:h.description||null};d?(await se.create(e),x("Конфигурация создана")):(await se.update(n.id,e),x("Конфигурация обновлена")),c(!1),f()}catch(e){j(e.message||"Ошибка сохранения")}finally{p(!1)}}else j("Введите название")},loading:u,children:d?"Создать":"Сохранить"})]})]})})]})}const ze=[{id:"users",label:"Пользователи",icon:"👤"},{id:"films",label:"Типы пленок",icon:"🎞️"},{id:"configs",label:"Конфигурации",icon:"⚙️"}];const Te=function(){const[e,s]=(0,t.useState)("users");return(0,g.jsx)(R,{children:(0,g.jsxs)("div",{className:"GLSHsWaA",children:[(0,g.jsxs)("div",{className:"s_9B6LkX",children:[(0,g.jsx)("h1",{className:"m0hicF9l",children:"Админ-панель"}),(0,g.jsx)("p",{className:"sEGa0_5T",children:"Управление пользователями, типами пленок и конфигурациями оборудования"})]}),(0,g.jsx)("div",{className:"apyCzRwl",children:ze.map(a=>(0,g.jsxs)("button",{className:"UlRbv730 "+(e===a.id?"Qk9HO3ks":""),onClick:()=>s(a.id),children:[(0,g.jsx)("span",{className:"FTfxxh0Z",children:a.icon}),a.label]},a.id))}),(0,g.jsx)("div",{className:"_hfHu8YF",children:(()=>{switch(e){case"users":return(0,g.jsx)($e,{});case"films":return(0,g.jsx)(qe,{});case"configs":return(0,g.jsx)(Ae,{});default:return null}})()})]})})},Ee=function(){return(0,g.jsx)(n.Kd,{children:(0,g.jsx)(f,{children:(0,g.jsxs)(N,{children:[(0,g.jsx)(X,{}),(0,g.jsxs)(r.BV,{children:[(0,g.jsx)(r.qh,{path:o,element:(0,g.jsx)(Y,{})}),(0,g.jsx)(r.qh,{path:h,element:(0,g.jsx)(Z,{children:(0,g.jsx)(de,{})})}),(0,g.jsx)(r.qh,{path:m,element:(0,g.jsx)(Z,{children:(0,g.jsx)(je,{})})}),(0,g.jsx)(r.qh,{path:"/experiments/:id",element:(0,g.jsx)(Z,{children:(0,g.jsx)(ke,{})})}),(0,g.jsx)(r.qh,{path:u,element:(0,g.jsx)(Z,{requireAdmin:!0,children:(0,g.jsx)(Te,{})})}),(0,g.jsx)(r.qh,{path:"/",element:(0,g.jsx)(r.C5,{to:h,replace:!0})}),(0,g.jsx)(r.qh,{path:"*",element:(0,g.jsx)(r.C5,{to:h,replace:!0})})]})]})})})},We=document.getElementById("root");(0,i.H)(We).render((0,g.jsx)(t.StrictMode,{children:(0,g.jsx)(Ee,{})}))}},i={};function n(e){var s=i[e];if(void 0!==s)return s.exports;var a=i[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.m=t,e=[],n.O=(s,a,t,i)=>{if(!a){var r=1/0;for(o=0;o<e.length;o++){for(var[a,t,i]=e[o],l=!0,c=0;c<a.length;c++)(!1&i||r>=i)&&Object.keys(n.O).every(e=>n.O[e](a[c]))?a.splice(c--,1):(l=!1,i<r&&(r=i));if(l){e.splice(o--,1);var d=t();void 0!==d&&(s=d)}}return s}i=i||0;for(var o=e.length;o>0&&e[o-1][2]>i;o--)e[o]=e[o-1];e[o]=[a,t,i]},n.n=e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return n.d(s,{a:s}),s},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);n.r(i);var r={};s=s||[null,a({}),a([]),a(a)];for(var l=2&t&&e;("object"==typeof l||"function"==typeof l)&&!~s.indexOf(l);l=a(l))Object.getOwnPropertyNames(l).forEach(s=>r[s]=()=>e[s]);return r.default=()=>e,n.d(i,r),i},n.d=(e,s)=>{for(var a in s)n.o(s,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})},n.o=(e,s)=>Object.prototype.hasOwnProperty.call(e,s),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};n.O.j=s=>0===e[s];var s=(s,a)=>{var t,i,[r,l,c]=a,d=0;if(r.some(s=>0!==e[s])){for(t in l)n.o(l,t)&&(n.m[t]=l[t]);if(c)var o=c(n)}for(s&&s(a);d<r.length;d++)i=r[d],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(o)},a=self.webpackChunkscratchlab_frontend=self.webpackChunkscratchlab_frontend||[];a.forEach(s.bind(null,0)),a.push=s.bind(null,a.push.bind(a))})();var r=n.O(void 0,[96],()=>n(912));r=n.O(r)})();
//# sourceMappingURL=main.fda64954d491444d50d0.js.map